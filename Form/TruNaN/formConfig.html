<!-- form
{
  "Metadata": {
    "Id": "a499eabf-3567-4b70-86a1-a909b832fdd8",
    "Kind": "Html"
  }
}
-->
<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="auto">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>truNaN</title>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
 <link rel="stylesheet" href="https://trunan.com.br/_trunan/www/css/styles.css">
 <!--link rel="stylesheet" href="style.css"-->
 
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>
 <script type="text/javascript">
	var uiPathApi = {
		getValue: function (elementId) {
			// this is a callback, being called from the workflow
			// enter your own code to get element values
			var el = document.getElementById(elementId);
			if (el.value == undefined) {
				return el.innerHTML;
			} else {
				if (el.checked == undefined) {
					return el.value;
				} else {
					return el.checked;
				}
			}
		},

		setValue: function (elementId, value) {
			
			if (elementId === 'financeiro'){
				if (value === 'Fatura'){
					var divElement = document.createElement('div');
					  divElement.classList.add('row');
					  var linkElement = document.createElement('a');
					  linkElement.classList.add('btn', 'btn-full', 'btn-warning');
					  linkElement.href = '#';
					  linkElement.textContent = 'Sua fatura já está disponível aqui!';

					  divElement.appendChild(linkElement);
					  var containerElement = document.getElementById('financeiro');
					  containerElement.appendChild(divElement);
					
				
				} else if (value === 'Atencao' || value === 'Bloqueado')  {
				 
				  var texto = 'Atenção! Sua licença está expirada, efetue o pagamento da fatura para liberar todas as funções da automação.'
				  if (value === 'Bloqueado'){
					var texto = 'Atenção! O seu sistema está bloqueado no momento, efetue o pagamento para continuar usando as automações'
				  }
				  
				  var spanElement = document.createElement('span');
				  spanElement.classList.add('d-block', 'p-1', 'text-bg-danger');
				  spanElement.textContent = texto;

				  var linkElement = document.createElement('a');
				  linkElement.classList.add('btn', 'btn-light', 'btn-sm');
				  linkElement.href = '#';
				  linkElement.textContent = 'Gerar Fatura Online';

				  spanElement.appendChild(linkElement);
				  var containerElement = document.getElementById('financeiro');
				  containerElement.appendChild(spanElement);
				}
				
				
			} else if (elementId === 'dataCliente') {
				limparModalCliente();
				var jsonData = value;
				var data = JSON.parse(jsonData);
				var idCliente = data['ID_CLIENTE'];

				for (var key in data) {
					if (data.hasOwnProperty(key)) {
						var el = document.getElementById(key);
						if (el == null) {
							var elements = document.querySelectorAll('[name="' + key + '"]');
							el = elements[0];
						}
						if (el) {
							if (el.tagName === 'SELECT') {
								console.log(key + data[key]);
								el.value = data[key];
								if(el.value === '' || el.value === null){
									el.value = 'Default';
								}
							} else if (el.tagName === 'INPUT' && el.type === 'radio') {
								var value = key+'_'+data[key];
								var radioButton = document.getElementById(value);
								
								if (radioButton) {
									radioButton.checked = true;
								}
								
							} else if (typeof data[key] === 'boolean') {
								//alert(key);
								var label = document.querySelector('label[for="' + key + '"]');
								el.checked = data[key];
								if (key === 'SITUACAO'){
									//label.textContent = data[key] ? 'Ativo' : 'Inativo';
								} else {
									//label.textContent = data[key] ? 'Sim' : 'Não';
								}
							} else {
								el.value = data[key];
								if (key === 'ID_CLIENTE'){
									document.getElementById('SalvarCliente').disabled = false;
									if (data[key] === 0 || data[key] === '' || data[key] === null || data[key] === undefined ){
										document.getElementById('ExcluirCliente').disabled = true;
									} else {
										document.getElementById('ExcluirCliente').disabled = false;
									}
								} else if (key === 'CODIGO_LOGIN' || key === 'CADASTRO_ECONOMICO') {
									if (data[key] === '' || data[key] === null || data[key] === undefined ){
										document.getElementById(key).disabled = true;
									} else {
										document.getElementById(key).disabled = false;
									}
								}
							}
						}
					}
				}
			} else if (elementId === 'FiltroCheckbox'){
				if (value == 'Todos') {
					document.getElementById(elementId).checked = true;
				} else if (value =='Nenhum'){
					document.getElementById(elementId).checked = false;
				} else {
					document.getElementById(elementId).indeterminate = true;
					//$('#FitroCheckbox').prop('indeterminate', true);
				} 
			} else if (elementId === 'parametros') {
				showLoading();
				var jsonData = value;
				var data = JSON.parse(jsonData);
				
				for (var key in data) {
					if (data.hasOwnProperty(key)) {
						var el = document.getElementById(key);
						if (el == null) {
							var elements = document.querySelectorAll('[name="' + key + '"]');
							el = elements[0];
						}
						if (el) {
							if (el.tagName === 'INPUT' && el.type === 'radio') {
								var radioButtonXML = document.getElementById(key + 'XML');
								var radioButtonTXT = document.getElementById(key + 'TXT');
								if (data[key] === 'XML') {
									radioButtonXML.checked = true;
									radioButtonTXT.checked = false;
								} else {
									radioButtonXML.checked = false;
									radioButtonTXT.checked = true;
								}
							} else if (typeof data[key] === 'boolean') {
								var label = document.querySelector('label[for="' + key + '"]');
								el.checked = data[key];
								if (key === 'FiltrarClientesPendentes'){
									//label.textContent = data[key] ? 'Clientes Pendentes' : 'Todos os Clientes';
								} else {
									try {
									  label.textContent = data[key] ? 'Sim' : 'Não';
									} catch (error) {
									}
								}
							} else {
								el.value = data[key];
								if (key === 'IPMCodigoLogin') {
									if (data[key] === '' || data[key] === null || data[key] === undefined){
										document.getElementById('IPMCodigoLogin').disabled = true;
									} else {
										document.getElementById('IPMCodigoLogin').disabled = false;
									}
								}
							}
						}
					}
				}
			} else if (elementId === 'dominio') {
				var jsonData = value;
				var data = JSON.parse(jsonData);
				
				for (var key in data) {
					if (data.hasOwnProperty(key)) {
						var el = document.getElementById(key);
						if (el) {
							el.value = data[key];
						}
					}
				}
			} else if (elementId === 'listaPerfil') {
				var jsonData = value;
				var data = JSON.parse(jsonData);
				var perfilSelect  = document.getElementById('Perfil');
				
				while (perfilSelect.options.length > 0) {
				  perfilSelect.remove(0);
				}
				perfilSelect.innerHTML = '';
				
				var tabela = document.getElementById('myTablePerfil');
				
				while (tabela.rows.length > 0) {
					tabela.deleteRow(0);
				}
				
				var tableBody = $("#myTablePerfil");
				
				data.forEach(function(item) {
					
					if (item.SITUACAO) {
						var option = document.createElement('option');
						option.value = item.ID_PERFIL;
						option.text = item.PERFIL;
					  perfilSelect.appendChild(option);
					}
					
					var row = $('<tr>');
					var codigoInput = $('<input>').attr('type', 'text').prop('class', 'form-control form-control-extra-sm').prop('id', 'ID_PERFIL_'+ item.ID_PERFIL).prop('name', 'ID_PERFIL_'+ item.ID_PERFIL).prop("value",item.ID_PERFIL).prop('readonly', true);
					var codigoCell = $("<td>").prop('class', 'col-2 fw-normal').append(codigoInput);
					row.append(codigoCell);
									
					var perfilInput = $('<input>').attr('type', 'text').prop('class', 'form-control form-control-extra-sm').prop('id', 'PERFIL_'+ item.ID_PERFIL).prop('name', 'PERFIL_'+ item.ID_PERFIL).prop("value",item.PERFIL);
					var perfilCell = $("<td>").prop('class', 'col-10').append(perfilInput);
					row.append(perfilCell);
					
					//Ativou ou Inativo
					var td = $('<td>').prop('class', 'col-2 fw-normal');
					var div = $('<div>').prop('class', 'd-flex justify-content-center align-items-center');
					var formCheck = $('<div>').prop('class', 'form-check form-switch form-check-inline');
					var input = $('<input>').prop('class', 'form-check-input SITUACAO').attr('type', 'checkbox').attr('role', 'switch').attr('id', 'SITUACAO_'+ item.ID_PERFIL).attr('name', 'SITUACAO_'+ item.ID_PERFIL);
					if (item.SITUACAO) {
					  input.prop('checked', true);
					}
					var label = $('<label>').prop('class', 'form-check-label').attr('for', 'SITUACAO_'+ item.ID_PERFIL).text(item.SITUACAO ? 'Ativo' : 'Inativo');
					formCheck.append(input, label);
					div.append(formCheck);
					td.append(div);
					row.append(td);
					
					tableBody.append(row);
					
					$('.btn-excluir-perfil').click(function() {
					  var id = $(this).attr('id');
					  excluirPerfil(id);
					});
					
				  
				});
				
				var ckPerfilSituacao = document.querySelectorAll('input[id^="SITUACAO_"]');
					ckPerfilSituacao.forEach(function(checkbox) {
					  var labelPerfil = document.querySelector('label[for="' + checkbox.id + '"]');

					  checkbox.addEventListener('change', function() {
						if (this.checked) {
						  labelPerfil.textContent = 'Sim';
						} else {
						  labelPerfil.textContent = 'Não';
						}
					  });
					});
				
			} else if (elementId === 'rowCliente') {
				
				var jsonData = value;
				var data = JSON.parse(jsonData);
				$('table tr').each(function() {
					var row = $(this);
					var ID_CLIENTE = row.find("#ID_EXECUTAR").val();
					console.log(ID_CLIENTE);
					if(ID_CLIENTE === data['ID_CLIENTE']){
						row.find('.observacao').text(data['OBSERVACAO']);
						return false;
					}
				});
			} else if (elementId === 'listaClientes') {
				var altura = window.innerHeight;
				var nPag = 22;
				var fontSize = 9;
				if (window.innerHeight > 1080) {
				  nPag = 40;
				  fontSize = 11;
				} else if (window.innerHeight > 900 ) {
				  nPag = 35;
				  fontSize = 10;
				} else if (window.innerHeight > 720) {
				  nPag = 25;
				}
				var myTableHead  = document.getElementById('myTableHead');
				myTableHead.style.fontSize = ''+fontSize+'px';
				
				var tabela = document.getElementById('myTable');
				while (tabela.rows.length > 0) {
					tabela.deleteRow(0);
				}
				var jsonData = value;
				var data = JSON.parse(jsonData);
				var tableBody = $("#myTable");
				var nItem = 0;
					
				data.forEach(function(item) {
					var row = $('<tr>').prop('class', 'align-items-center').prop('style', 'font-size: '+fontSize+'px;');
					nItem++;
					if(nItem > nPag){
						row.css('display', 'none');
					}
					// TD 1
					var td = $('<td>').prop('class', 'col-6 fw-normal');
					var div = $('<div>').prop('class', 'd-flex justify-content-start align-items-center');
					var col = $('<div>').prop('class', 'col-1 executar').prop('id','ID_EXECUTAR').prop('value', item.ID_CLIENTE).text(item.CODIGO);
					var ico = $('<i>').prop('class', 'bi bi-pencil-square');
					var btn = $('<button>').attr('type', 'button').prop('class', 'btn btn-warning custom-btn-extra-small me-2').attr('data-bs-theme', 'dark' ).attr('data-bs-toggle', 'modal' ).attr('data-bs-target', '#clienteModal').attr('onclick', 'buscarCliente('+item.CODIGO+')').prop('name', item.ID_CLIENTE).prop("value",item.ID_CLIENTE).append(ico);
					div.append(btn)
					div.append(col);
					col = $('<div>').prop('class', 'col-2 d-flex justify-content-center  me-2').text(item.CNPJ);
					div.append(col);
					col = $('<div>').prop('class', 'col-9').text(item.EMPRESA);
					div.append(col);
					
					td.append(div);
					row.append(td);
					
					// TD 2
					var td = $('<td>').prop('class', 'col-6 fw-normal');
					var div = $('<div>').prop('class', 'd-flex justify-content-start align-items-center');
					var col = $('<div>').prop('class', 'col-11');
					var obs = $('<div>').prop('class', 'observacao').prop('id','ID_OBSERVACAO_'+item.ID_CLIENTE).text(item.OBSERVACAO).attr('style', 'display: block;');
					col.append(obs);
					div.append(col);
					
					
					col = $('<div>').prop('class', 'col-1');
					var divF = $('<div>').prop('class', 'd-flex justify-content-end align-items-center');
					/*
					var ico = $('<i>').prop('class', 'bi bi-pencil-square');
					var btn = $('<button>').attr('type', 'button').prop('class', 'btn btn-warning custom-btn-extra-small me-2').attr('data-bs-theme', 'dark' ).attr('data-bs-toggle', 'modal' ).attr('data-bs-target', '#clienteModal').attr('onclick', 'buscarCliente('+item.CODIGO+')').prop('name', item.ID_CLIENTE).prop("value",item.ID_CLIENTE).append(ico);
					divF.append(btn)
					*/
					
					var checkbox = $('<input>').attr('type', 'checkbox').prop('class','ProcessCheckbox PendenciaInput form-check-input').prop('id','EXECUTAR').prop('name',item.ID_CLIENTE+item.PENDENCIA).attr('onclick', 'repetirCliente('+item.ID_CLIENTE+', null)');
					
					if (item.PENDENCIA == 'Todos') {
						checkbox.prop('checked', true);
					} else if (item.PENDENCIA =='Nenhum'){
						checkbox.prop('checked', false);
					} else {
						checkbox.prop('indeterminate', true);
					} 
					/*
					if (item.EXECUTAR === 'True') {
						checkbox.prop('checked', true);
					} else {
						//checkbox.prop("disabled", true)
					}
					*/
					divF.append(checkbox);
					
					
					col.append(divF);
					div.append(col);
					td.append(div);
					row.append(td);
					
					row.on('dblclick', function () {
						const checkbox = $(this).find('input[type="checkbox"]');
						if (checkbox.prop('indeterminate')){
							checkbox.prop('indeterminate', false);
							checkbox.prop('checked', false);
						} else if (checkbox) {
							checkbox.prop('checked', !checkbox.prop('checked'));
						}
						repetirCliente(item.ID_CLIENTE, null);
					});
					
					tableBody.append(row);
				});
				
				initializePagination(data, nPag, 'myTable', 'pagination' );
				
				var processCheckboxAll = document.querySelector('.ProcessCheckboxAll');
				var processCheckboxes = document.querySelectorAll('.ProcessCheckbox');
				var observacaoCheckboxes = document.querySelectorAll('.observacao');
				var executarCheckboxes = document.querySelectorAll('.executar');
				

				processCheckboxAll.addEventListener('change', function() {
					
					if (processCheckboxAll.checked) {
						repetirAutomacao(null);
					  // Marca todos os checkboxes "ProcessCheckbox"
						processCheckboxes.forEach(function(processCheckbox, index) {
							if (!processCheckbox.disabled) {
								processCheckbox.indeterminate = false;
								processCheckbox.checked = true;
								observacaoCheckboxes[index].style.display = 'block';
								if (observacaoCheckboxes[index].textContent  === '' || observacaoCheckboxes[index].textContent  === null || observacaoCheckboxes[index].textContent  === undefined){
									//repetirCliente(executarCheckboxes[index].value, null);
								}
								
							}
						});
					} else {
						// Desmarca todos os checkboxes "ProcessCheckbox"
						processCheckboxes.forEach(function(processCheckbox, index) {
							processCheckbox.indeterminate = false;
							processCheckbox.checked = false;
							observacaoCheckboxes[index].style.display = 'none';
							processCheckbox.name = executarCheckboxes[index].value+'Nenhum';
						});
					}
				});
				
				hideLoading(); // desativa animação
				
			} else if (elementId === 'listaImportacao') {
				var tabela = document.getElementById('myTableImportacao');
				while (tabela.rows.length > 0) {
					tabela.deleteRow(0);
				}
				var jsonData = value;
				var data = JSON.parse(jsonData);
				var tableBody = $("#myTableImportacao");
				var nItem = 0;
				var altura = window.innerHeight;
				var nPag = 15;
				data.forEach(function(item) {
					var row = $('<tr>');
					nItem++;
					if(nItem > nPag){
						row.css('display', 'none');
					}
					var td = $('<td>').prop('class', 'col-1').prop('id','IMP_CODIGO').prop('value', item.CODIGO).text(item.CODIGO);
					row.append(td);
					
					td = $('<td>').prop('class', 'col-2 me-2');
					var div = $('<div>').prop('class', 'd-flex justify-content-center').text(item.CNPJ);
					td.append(div);
					row.append(td);
					
					td = $('<td>').prop('class', 'col-8').text(item.EMPRESA);
					row.append(td);
					
					td = $('<td>').prop('class', 'col-1');
					var btn = $('<button>').attr('type', 'button').prop('class', 'btn btn-warning custom-btn-extra-small').attr('onclick', 'adicionarCliente('+item.CODIGO+')').prop('name', item.CODIGO).prop("value",item.CODIGO).text('Importar');
					div = $('<div>').prop('class', 'd-flex justify-content-end');
					div.append(btn);
					td.append(div);
					row.append(td);
					
					tableBody.append(row);
				});
				initializePagination(data, nPag, 'myTableImportacao', 'paginationImportacao');
						//initializePagination(data, nPag);
			} else {
				var el = document.getElementById(elementId);
				if (el == null) {
					var el = document.getElementById(value);
				} 
				if ((el.tagName === 'INPUT' && el.type === 'text') || el.type === 'email') {
					el.value = value;
				} else if (el.tagName === 'INPUT' && el.type === 'file') {
					el.value = value;
				} else if (el.tagName === 'SELECT') {
					el.value = value;
				}  else {
					el.innerHTML = value;
				}
			}
		},
		sendMessage: function (id, value) { },
	};
 </script>
 <script>
	
	function addNovoPerfilClicked(){
		var perfilNome = document.getElementById("novoPerfil").value;
		
		if (perfilNome !== null && perfilNome !== '') {
			var jsonData = {
				"Perfil": perfilNome
			}
			var jsonString = JSON.stringify(jsonData);
			uiPathApi.sendMessage("addPerfil", jsonString );
		}
		perfilNome.value = '';
	}
	
	function atualizaPerfil(value){
		var jsonData = [];
		var tbody = document.getElementById('myTablePerfil');
		var rows = tbody.getElementsByTagName('tr');
		for (var i = 0; i < rows.length; i++) {
		  var row = rows[i];
		  var ID_PERFIL = row.querySelector('input[id^="ID_PERFIL_"]').value;
		  var PERFIL = row.querySelector('input[id^="PERFIL_"]').value;
		  var SITUACAO = row.querySelector('input[id^="SITUACAO_"]').checked;
			
		  var rowValues = {
			  'ID_PERFIL': ID_PERFIL,
			  'PERFIL': PERFIL,
			  'SITUACAO': SITUACAO
			};
			if(ID_PERFIL){
				jsonData.push(rowValues);
			}
		}
		var jsonResult = JSON.stringify(jsonData);
		uiPathApi.sendMessage("atualizarPerfil", jsonResult);
	}
	
	function fecharAutomacao() {
		uiPathApi.sendMessage("close");
	}
	
	function changedPerfil(perfil) {
		showLoading();
		var jsonDataObj = jsonData();
		jsonDataObj['Perfil'] = perfil;
		var jsonString = JSON.stringify(jsonDataObj);
		uiPathApi.sendMessage("perfil", jsonString );
	}
	
	function iniciarAutomacao() {
		
		var jsonClientes = []; // Array para armazenar os objetos JSON de cada linha
		$('table tr').each(function() {
			var row = $(this);
			var ID_CLIENTE = row.find("#ID_EXECUTAR").val();
			if(ID_CLIENTE){
				var rowValues = {
					'ID_CLIENTE': ID_CLIENTE,
					'PENDENCIA': row.find(".PendenciaInput").attr('name'),
					'EXECUTAR': row.find(".ProcessCheckbox").is(":checked")
				};
				jsonClientes.push(rowValues);
			}
		});
		
		var jsonAutomacao = {
			"Perfil": document.getElementById("Perfil").value,
			"Periodo": document.getElementById("Periodo").value,
			"RepetirAutomacao": document.getElementById("RepetirAutomacao").innerText,
			
			"IPMLogin": document.getElementById("IPMLogin").value,
			"IPMPassword": document.getElementById("IPMPassword").value,
			"IPMCodigoLogin": document.getElementById("IPMCodigoLogin").value,
			
			"DownloadSaida": document.getElementById("DownloadSaida").value,
			"DownloadEntrada": document.getElementById("DownloadEntrada").value,
			"ProtocolarSaida": document.getElementById("ProtocolarSaida").value,
			"ProtocolarEntrada": document.getElementById("ProtocolarEntrada").value,
			"SimplesNacional": document.getElementById("SimplesNacional").value,
			"SolicitacaoCancelamento": document.getElementById("SolicitacaoCancelamento").value,
			"Relatorio": document.getElementById("Relatorio").value
		};
		
		var jsonData = {
			"Automacao": jsonAutomacao,
			"Clientes": jsonClientes
		};
		
		var jsonString = JSON.stringify(jsonData);

		uiPathApi.sendMessage("start", jsonString);
	}
	
	function salvarParametros() {
		var jsonString = JSON.stringify(jsonData());
		uiPathApi.sendMessage("save", jsonString);
	}
	
	function salvarDominio() {
		var jsonDominio = {
			"Perfil": document.getElementById("Perfil").value,
			"DominioLogin": document.getElementById("DominioLogin").value,
			"DominioPassword": document.getElementById("DominioPassword").value
		};
		uiPathApi.sendMessage("dominio", jsonDominio);
	}
	
	function jsonData(){
		var jsonData = {
			"Perfil": document.getElementById("Perfil").value,
			"Periodo": document.getElementById("Periodo").value,
			"RepetirAutomacao": document.getElementById("RepetirAutomacao").innerText,
			
			
			"IPMLogin": document.getElementById("IPMLogin").value,
			"IPMPassword": document.getElementById("IPMPassword").value,
			"IPMCodigoLogin": document.getElementById("IPMCodigoLogin").value,
			
			"DownloadSaida": document.getElementById("DownloadSaida").value,
			"DownloadEntrada": document.getElementById("DownloadEntrada").value,
			"ProtocolarSaida": document.getElementById("ProtocolarSaida").value,
			"ProtocolarEntrada": document.getElementById("ProtocolarEntrada").value,
			"SimplesNacional": document.getElementById("SimplesNacional").value,
			"SolicitacaoCancelamento": document.getElementById("SolicitacaoCancelamento").value,
			"Relatorio": document.getElementById("Relatorio").value
		};
		return jsonData;
	}
	
	function jsonCliente(){
		var jsonData = {
			"ID_CLIENTE": document.getElementById("ID_CLIENTE").value,
			"CNPJ": document.getElementById("CNPJ").value,
			"CODIGO": document.getElementById("CODIGO").value,
			"EMPRESA": document.getElementById("EMPRESA").value,
			"NOME": document.getElementById("NOME").value,
			"REGIME_TRIBUTARIO": document.getElementById("REGIME_TRIBUTARIO").value,
			"SITUACAO": document.getElementById("SITUACAO").checked,
			
			"LOGIN": document.getElementById("LOGIN").value,
			"PASSWORD": document.getElementById("PASSWORD").value,
			"CODIGO_LOGIN": document.getElementById("CODIGO_LOGIN").value,
			"CADASTRO_ECONOMICO": document.getElementById("CADASTRO_ECONOMICO").value
		};
		jsonString = JSON.stringify(jsonData);
		return jsonString;
	}
	
	function buscarCliente(valor){
		
		if (valor !== null && valor !== '') {
			var codigoInput = document.getElementById('CODIGO').value;
			var cnpjInput = document.getElementById('CNPJ').value;
		
			var jsonData = {
				"var": valor,
				"CODIGO": codigoInput,
				"CNPJ": cnpjInput
			}
			var jsonString = JSON.stringify(jsonData);
			//alert(jsonString);
			uiPathApi.sendMessage("buscarCliente", jsonString );
			
		}
	} 
	
	function excluirCliente(){
		var jsonString = jsonCliente();
		limparModalCliente();
		uiPathApi.sendMessage("excluirCliente", jsonString );
	}
			
	function salvarCliente() {
		uiPathApi.sendMessage("salvarCliente", jsonCliente());
		limparModalCliente();
	}
	
	function importarClientes() {
		limparModalCliente();
		document.getElementById("divClienteCadastro").style.display = "none";
		document.getElementById("divClienteImportar").style.display = "block";
		uiPathApi.sendMessage("importarClientes");
	}
	
	function adicionarCliente(valor){
		var jsonData = {
			"CODIGO": valor
		}
		var jsonString = JSON.stringify(jsonData);
		//alert(jsonString);
		uiPathApi.sendMessage("adicionarCliente", jsonString );
	}

	function repetirCliente(id, tipo) {
		var tipos = ['Parcial', 'Todos', 'Nenhum'];
		if (tipo === null){
			for (var i = 0; i < tipos.length; i++) {
				var checkboxes = document.getElementsByName(id + tipos[i]);
				var observacao= document.getElementById('ID_OBSERVACAO_'+id);
				if (checkboxes.length > 0) {
					var checkbox = checkboxes[0];
					checkbox.indeterminate = false;
					if (checkbox.checked) {
						tipo = 'Todos';
						checkbox.name = id + 'Todos';
						observacao.style.display = 'block';
					} else {
						tipo = 'Nenhum';
						checkbox.name = id + 'Nenhum';
						observacao.style.display = 'none';
					}
					break;
				}
			}
		}
		
		var jsonData = {
			"ID_CLIENTE": id,
			"PENDENCIA": tipo
		}
		var jsonString = JSON.stringify(jsonData);
		//alert(jsonString);
		uiPathApi.sendMessage("repetirCliente", jsonString );
	}
 
 </script>
 	
</head>
<body>
	
	<div class="overlay" id="overlay">
		<!--div class="loader"></div-->
		<div class="lottie-animation" id="lottie-animation"></div>
		<div class="loading-text">Carregando...</div>
	</div>
	
	<header>
	  <div class="logo d-flex justify-content-center align-items-center">
		 <img src="https://trunan.com.br/_trunan/img/rpa.png" alt="truNaN" width="150" height="auto">
	  </div>

	  <div class="search d-flex align-items-center " >
		<div class="col-4 d-flex justify-content-start align-items-center">
			<input type="text" class="form-control form-control-extra-sm m-2" id="Periodo" name="Periodo" data-inputmask="'mask': '99/9999'" placeholder="" value="" style="width: 75px;">
			<select class="form-select select-control-extra-sm me-2" id="Perfil" style="width: 250px;"></select>
			<!--select class="form-select select-control-extra-sm me-2" id="RepetirAutomacao" style="width: 125px;">
				<option value="False">Rotinas Pendentes</option>
				<option value="True">Repetir as Rotinas</option>
			</select-->
		</div>
		<div class="col-4 d-flex justify-content-center">
			<input type="text" class="form-control form-control-extra-sm" id="myInput" placeholder="Pesquisar..." style="width: 250px;">
		</div>
		<div class="col-4 d-flex justify-content-end">
			<div class="dropdown">
			  <button class="btn btn-warning custom-btn-extra-small" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="width: 100px; height: 25px">
				<i class="bi bi-gear"></i> Configurações
			  </button>
			  <ul class="dropdown-menu dropdown-menu-dark  small-text">
				<li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#parametrosModal">Parâmetros</a></li>
				<li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#dominioModal">Sistema Domínio</a></li>
				<li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#perfilModal">Perfil Automação</a></li>
				<li><hr class="dropdown-divider"></li>
				<li><a class="dropdown-item" onclick="fecharAutomacao()">Fechar</a></li>
			  </ul>
			</div>
		</div>
	  </div>
	</header>
	<main>
      <!-- Conteúdo da barra lateral direita -->
		<aside id="menu"></aside>
	
		<!-- Conteúdo principal com barra de rolagem -->
		<div class="scrollable-content">
			<div class="table-responsive-sm ">
				<table class="table table-sm table-dark caption-top table-striped table-hover" >
					<thead class="table-dark">
						<tr class="align-items-center small-text" id="myTableHead">
							<th class="col-6 fw-normal">
								<div class="d-flex justify-content-start align-items-center">
									<button id="addPerfil" type="button" class="btn btn-primary custom-btn-extra-small me-2" data-bs-toggle="modal" data-bs-target="#clienteModal" onclick="limparModalCliente()"><i class="bi bi-person-plus-fill"></i></button>
									<div class="col-1" >Cod</div>
									<div class="col-2 d-flex justify-content-center  me-2" ><div class="d-flex justify-content-center">CNPJ/CPF</div></div>
									<div class="col-9" >Empresa</div>
								</div>
							</th>
							<th class="col-6 fw-normal">
								<div class="d-flex justify-content-start align-items-center">
									<div class="col-11" >Observação</div>
									<div class="col-1" >
										<div class="d-flex justify-content-end align-items-center">
											<input type="checkbox" class="ProcessCheckboxAll form-check-input" value="" id="FiltroCheckbox">
										</div>
									</div>
									
								</div>
							</th>
						</tr>
					</thead>
					<tbody id="myTable" class="small-text">
						<!--tr class="align-items-center">
							<td class="col-6 fw-normal">
								<div class="d-flex justify-content-start align-items-center">
									<button id="addPerfil" type="button" class="btn btn-primary custom-btn-extra-small me-2" data-bs-toggle="modal" data-bs-target="#clienteModal" onclick="limparModalCliente()"><i class="bi bi-person-plus-fill"></i></button>
									<div class="col-1" >9999</div>
									<div class="col-2 d-flex justify-content-center" >00.795.877/0001-16</div>
									<div class="col-9" >Evoluze softwares de gestao ltda 123</div>
								</div>
							</td>
							<td class="col-6 fw-normal">
								<div class="d-flex justify-content-start align-items-center">
									<div class="col-11" >XML-PDF Saida XML-PDF Entrada Protocolar Saida Protocolar Entrada SimplesNacional | Login Cliente</div>
									<div class="col-1" >
										<div class="d-flex justify-content-end align-items-center">
											<input type="checkbox" class="ProcessCheckbox form-check-input" id='EXECUTAR'>
										</div>
									</div>
								</div>
							</td>
						</tr-->
					</tbody>
				</table>
			</div>
		</div>
    </main>
	
   <footer>
		<div class="position-fixed d-flex align-items-center bottom-0 start-0 mb-0 ms-0 bd-mode-toggle" style="width: 250px; height: 30px">
		  <button class="btn btn-warning py-1 rounded-0 border-0 w-100" type="button" onclick="iniciarAutomacao()" >
			<div class="d-flex justify-content-center align-items-center">
				Iniciar
			</div>
		  </button>
		</div>
		<div class="d-flex justify-content-center align-items-end">
			<div class="pagination pagination-sm small-text" data-bs-theme="dark" id="pagination" style="height: 25px"></div>
		</div>
		<div class="position-fixed d-flex align-items-center bottom-0 end-0 mb-1 me-2 bd-mode-toggle">
			<label class="col-form-label" id="easterEgg" style="color: transparent;">Parcial</label>
			<label class="col-form-label" id="RepetirAutomacao" style="color: transparent;">False</label>
			<label class="col-form-label">Total Clientes: </label><label class="col-form-label" id="TotalClientes"></label>
		</div>
	</footer>

  <div name="ModalRobo">
  
	<div id="modal_repetir_automacao"></div>
	<div id="modal_dominio"></div>
	<div id="modal_cliente"></div>
	<div id="modal_parametros"></div>
	<div id="modal_perfil"></div>
	
	

	<div class="modal" data-bs-theme="dark" id="perfilModal" tabindex="-1" aria-labelledby="perfilModalTitle" aria-hidden="true">
		<!--div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"-->
		<div class="modal-dialog modal-dialog-scrollable">
			<div class="modal-content">
				<div class="modal-header">
					<h6 class="modal-title" id="perfilModalTitle">Cadastro de Perfil</h6>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="row">
						<input class="form-control form-control-extra-sm me-2" type="text" id="novoPerfil" placeholder="Nome do novo perfil" style="width: 380px; height: 29px">
						<button id="addPerfil" type="button" class="btn btn-warning custom-btn-extra-small" style="width: 85px; height: 29px" id="addPerfillLista" onclick="addNovoPerfilClicked()">Adicionar</button>
					</div>	
					
					<div class="row">
						<table class="table table-sm table-dark caption-top table-striped table-hover" >
							<thead class="table-dark">
								<tr>
									<th scope="col-2">#</th>
									<th scope="col-8">Perfil</th>
									<th scope="col-2"><div class="d-flex justify-content-center">Situaçao</div></th>
								</tr>
							</thead>
							<tbody id="myTablePerfil">
							</tbody>
						</table>
					</div>
				</div>
				<div class="modal-footer">
					<!--button type="button" class="btn btn-secondary custom-btn-extra-small" style="width: 85px; height: 29px" data-bs-dismiss="modal">Cancelar</button-->
					<button type="button" class="btn btn-primary custom-btn-extra-small" style="width: 85px; height: 29px" data-bs-dismiss="modal" onclick="atualizaPerfil()">Salvar</button>
				</div>
			</div>
		</div>
	</div>

	

  </div >



<!-- Limpar Cadastros -->
<script>
	function limparModalCliente() {
		//Chave = ID do campo, Valor = Bloquear ou não o campo se for input
		var jsonData = {
			"LOGIN": false,
			"PASSWORD": false,
			"CODIGO_LOGIN": true,
			"CADASTRO_ECONOMICO": true
		};
		limparFormCliente(JSON.stringify(jsonData));
	}
	
	var selectPerfil = document.getElementById('Perfil');
	function perfilChanged() {
		var selectedValue = selectPerfil.value;
		changedPerfil(selectedValue);
	}
	selectPerfil.addEventListener('change', perfilChanged);
	document.getElementById('Periodo').addEventListener('blur', perfilChanged);
	
	$(document).ready(function () {
		  Inputmask("99999-999").mask("#Periodo");
    });

</script>
	
<!-- Tabela>	
<script>
	
	document.addEventListener('DOMContentLoaded', function () {
	  const linhasTabela = document.querySelectorAll('#myTable tr');

	  linhasTabela.forEach((linha) => {
		let clicado = false;

		linha.addEventListener('click', function () {
		  if (clicado) {
			const checkbox = this.querySelector('input[type="checkbox"]');
			if (checkbox) {
			  checkbox.checked = !checkbox.checked;
			}
			clicado = false;
		  } else {
			clicado = true;
			setTimeout(() => clicado = false, 300); // Definindo o limite de tempo para o segundo clique
		  }
		});
	  });
	});
	
	// Adicionando evento de duplo clique às linhas da tabela
	let table = document.getElementById('myTable');
	let rows = table.getElementsByTagName('tr');

	for (let i = 0; i < rows.length; i++) {
		rows[i].ondblclick = function() {
		  // Executa uma ação ao dar duplo clique na linha
		  console.log('Você deu dois cliques na linha:', i + 1);
		  // Aqui você pode adicionar a lógica que deseja executar ao dar duplo clique na linha
		};
	}

	
	
	
</script -->

<script src="js/content.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.8/lottie.min.js"></script>
<script src="animacao.js"></script>
<script src="js/menu.js"></script>
<script src="js/paginacao.js"></script>	
<script src="js/validacoes.js"></script>
<script src="js/modal_cliente.js"></script>
<script src="js/modal_parametros.js"></script>
<script src="js/change.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://trunan.com.br/_trunan/www/js/bootpag.js"></script>
  
</body>
</html>
