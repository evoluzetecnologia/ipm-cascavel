<!-- form
{
  "Metadata": {
    "Id": "a499eabf-3567-4b70-86a1-a909b832fdd8",
    "Kind": "Html"
  }
}
-->
<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="auto">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>truNaN</title>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
 <link rel="stylesheet" href="https://trunan.com.br/_trunan/www/css/styles.css">
 <!--link rel="stylesheet" href="style.css"-->
 
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>
 <script type="text/javascript">
	var uiPathApi = {
		getValue: function (elementId) {
			// this is a callback, being called from the workflow
			// enter your own code to get element values
			var el = document.getElementById(elementId);
			if (el.value == undefined) {
				return el.innerHTML;
			} else {
				if (el.checked == undefined) {
					return el.value;
				} else {
					return el.checked;
				}
			}
		},

		setValue: function (elementId, value) {
			
			if (elementId === 'dataCliente') {
				limparModalCliente();
				inArrayJson(value, ['CODIGO_LOGIN', 'CADASTRO_ECONOMICO']);
				
				/*
				else if (disableArray.includes(key)) {
						if (data[key] === '' || data[key] === null || data[key] === undefined) {
                            el.disabled = true;
                        } else {
                            el.disabled = false;
                        }
					}
				var jsonData = value;
				var data = JSON.parse(jsonData);
				var idCliente = data['ID_CLIENTE'];
				
				for (var key in data) {
					if (data.hasOwnProperty(key)) {
						var el = document.getElementById(key);
						if (el == null) {
							var elements = document.querySelectorAll('[name="' + key + '"]');
							el = elements[0];
						}
						if (el) {
							if (el.tagName === 'SELECT') {
								console.log(key + data[key]);
								el.value = data[key];
								if(el.value === '' || el.value === null){
									el.value = 'Default';
								}
							} else if (el.tagName === 'INPUT' && el.type === 'radio') {
								var value = key+'_'+data[key];
								var radioButton = document.getElementById(value);
								
								if (radioButton) {
									radioButton.checked = true;
								}
								
							} else if (typeof data[key] === 'boolean') {
								//alert(key);
								var label = document.querySelector('label[for="' + key + '"]');
								el.checked = data[key];
								if (key === 'SITUACAO'){
									//label.textContent = data[key] ? 'Ativo' : 'Inativo';
								} else {
									//label.textContent = data[key] ? 'Sim' : 'Não';
								}
							} else {
								el.value = data[key];
								if (key === 'ID_CLIENTE'){
									document.getElementById('SalvarCliente').disabled = false;
									if (data[key] === 0 || data[key] === '' || data[key] === null || data[key] === undefined ){
										document.getElementById('ExcluirCliente').disabled = true;
									} else {
										document.getElementById('ExcluirCliente').disabled = false;
									}
								} else if (key === 'CODIGO_LOGIN' || key === 'CADASTRO_ECONOMICO') {
									if (data[key] === '' || data[key] === null || data[key] === undefined ){
										document.getElementById(key).disabled = true;
									} else {
										document.getElementById(key).disabled = false;
									}
								}
							}
						}
					}
				}
				*/
			} else if (elementId === 'FiltroCheckbox'){
				if (value == 'Todos') {
					document.getElementById(elementId).checked = true;
				} else if (value =='Nenhum'){
					document.getElementById(elementId).checked = false;
				} else {
					document.getElementById(elementId).indeterminate = true;
					//$('#FitroCheckbox').prop('indeterminate', true);
				} 
			} else if (elementId === 'dominio') {
				showLoading();
				inArrayJson(value, null);
				
			} else if (elementId === 'parametros') {
				showLoading();
				inArrayJson(value, ['IPMCodigoLogin']);
				
			} else if (elementId === 'listaPerfil') {
				var jsonData = value;
				var data = JSON.parse(jsonData);
				var perfilSelect  = document.getElementById('Perfil');
				
				while (perfilSelect.options.length > 0) {
				  perfilSelect.remove(0);
				}
				perfilSelect.innerHTML = '';
				
				var tabela = document.getElementById('myTablePerfil');
				
				while (tabela.rows.length > 0) {
					tabela.deleteRow(0);
				}
				
				var tableBody = $("#myTablePerfil");
				
				data.forEach(function(item) {
					
					if (item.SITUACAO) {
						var option = document.createElement('option');
						option.value = item.ID_PERFIL;
						option.text = item.PERFIL;
					  perfilSelect.appendChild(option);
					}
					
					var row = $('<tr>');
					var codigoInput = $('<input>').attr('type', 'text').prop('class', 'form-control form-control-extra-sm').prop('id', 'ID_PERFIL_'+ item.ID_PERFIL).prop('name', 'ID_PERFIL_'+ item.ID_PERFIL).prop("value",item.ID_PERFIL).prop('readonly', true);
					var codigoCell = $("<td>").prop('class', 'col-2 fw-normal').append(codigoInput);
					row.append(codigoCell);
									
					var perfilInput = $('<input>').attr('type', 'text').prop('class', 'form-control form-control-extra-sm').prop('id', 'PERFIL_'+ item.ID_PERFIL).prop('name', 'PERFIL_'+ item.ID_PERFIL).prop("value",item.PERFIL);
					var perfilCell = $("<td>").prop('class', 'col-10').append(perfilInput);
					row.append(perfilCell);
					
					//Ativou ou Inativo
					var td = $('<td>').prop('class', 'col-2 fw-normal');
					var div = $('<div>').prop('class', 'd-flex justify-content-center align-items-center');
					var formCheck = $('<div>').prop('class', 'form-check form-switch form-check-inline');
					var input = $('<input>').prop('class', 'form-check-input SITUACAO').attr('type', 'checkbox').attr('role', 'switch').attr('id', 'SITUACAO_'+ item.ID_PERFIL).attr('name', 'SITUACAO_'+ item.ID_PERFIL);
					if (item.SITUACAO) {
					  input.prop('checked', true);
					}
					var label = $('<label>').prop('class', 'form-check-label').attr('for', 'SITUACAO_'+ item.ID_PERFIL).text(item.SITUACAO ? 'Ativo' : 'Inativo');
					formCheck.append(input, label);
					div.append(formCheck);
					td.append(div);
					row.append(td);
					
					tableBody.append(row);
					
					$('.btn-excluir-perfil').click(function() {
					  var id = $(this).attr('id');
					  excluirPerfil(id);
					});
					
				  
				});
				
				var ckPerfilSituacao = document.querySelectorAll('input[id^="SITUACAO_"]');
					ckPerfilSituacao.forEach(function(checkbox) {
					  var labelPerfil = document.querySelector('label[for="' + checkbox.id + '"]');

					  checkbox.addEventListener('change', function() {
						if (this.checked) {
						  labelPerfil.textContent = 'Sim';
						} else {
						  labelPerfil.textContent = 'Não';
						}
					  });
					});
				
			} else if (elementId === 'rowCliente') {
				
				var jsonData = value;
				var data = JSON.parse(jsonData);
				$('table tr').each(function() {
					var row = $(this);
					var ID_CLIENTE = row.find("#ID_EXECUTAR").val();
					console.log(ID_CLIENTE);
					if(ID_CLIENTE === data['ID_CLIENTE']){
						row.find('.observacao').text(data['OBSERVACAO']);
						return false;
					}
				});
			} else if (elementId === 'listaClientes') {
				var altura = window.innerHeight;
				var nPag = 22;
				var fontSize = 9;
				if (window.innerHeight > 1080) {
				  nPag = 40;
				  fontSize = 11;
				} else if (window.innerHeight > 900 ) {
				  nPag = 35;
				  fontSize = 10;
				} else if (window.innerHeight > 720) {
				  nPag = 25;
				}
				var myTableHead  = document.getElementById('myTableHead');
				myTableHead.style.fontSize = ''+fontSize+'px';
				
				var tabela = document.getElementById('myTable');
				while (tabela.rows.length > 0) {
					tabela.deleteRow(0);
				}
				var jsonData = value;
				var data = JSON.parse(jsonData);
				var tableBody = $("#myTable");
				var nItem = 0;
					
				data.forEach(function(item) {
					var row = $('<tr>').prop('class', 'align-items-center').prop('style', 'font-size: '+fontSize+'px;');
					nItem++;
					if(nItem > nPag){
						row.css('display', 'none');
					}
					// TD 1
					var td = $('<td>').prop('class', 'col-6 fw-normal');
					var div = $('<div>').prop('class', 'd-flex justify-content-start align-items-center');
					var col = $('<div>').prop('class', 'col-1 executar').prop('id','ID_EXECUTAR').prop('value', item.ID_CLIENTE).text(item.CODIGO);
					var ico = $('<i>').prop('class', 'bi bi-pencil-square');
					var btn = $('<button>').attr('type', 'button').prop('class', 'btn btn-warning custom-btn-extra-small me-2').attr('data-bs-theme', 'dark' ).attr('data-bs-toggle', 'modal' ).attr('data-bs-target', '#clienteModal').attr('onclick', 'buscarCliente('+item.CODIGO+')').prop('name', item.ID_CLIENTE).prop("value",item.ID_CLIENTE).append(ico);
					div.append(btn)
					div.append(col);
					col = $('<div>').prop('class', 'col-2 d-flex justify-content-center  me-2').text(item.CNPJ);
					div.append(col);
					col = $('<div>').prop('class', 'col-9').text(item.EMPRESA);
					div.append(col);
					
					td.append(div);
					row.append(td);
					
					// TD 2
					var td = $('<td>').prop('class', 'col-6 fw-normal');
					var div = $('<div>').prop('class', 'd-flex justify-content-start align-items-center');
					var col = $('<div>').prop('class', 'col-11');
					var obs = $('<div>').prop('class', 'observacao').prop('id','ID_OBSERVACAO_'+item.ID_CLIENTE).text(item.OBSERVACAO).attr('style', 'display: block;');
					col.append(obs);
					div.append(col);
					
					
					col = $('<div>').prop('class', 'col-1');
					var divF = $('<div>').prop('class', 'd-flex justify-content-end align-items-center');
					/*
					var ico = $('<i>').prop('class', 'bi bi-pencil-square');
					var btn = $('<button>').attr('type', 'button').prop('class', 'btn btn-warning custom-btn-extra-small me-2').attr('data-bs-theme', 'dark' ).attr('data-bs-toggle', 'modal' ).attr('data-bs-target', '#clienteModal').attr('onclick', 'buscarCliente('+item.CODIGO+')').prop('name', item.ID_CLIENTE).prop("value",item.ID_CLIENTE).append(ico);
					divF.append(btn)
					*/
					
					var checkbox = $('<input>').attr('type', 'checkbox').prop('class','ProcessCheckbox PendenciaInput form-check-input').prop('id','EXECUTAR').prop('name',item.ID_CLIENTE+item.PENDENCIA).attr('onclick', 'repetirCliente('+item.ID_CLIENTE+', null)');
					
					if (item.PENDENCIA == 'Todos') {
						checkbox.prop('checked', true);
					} else if (item.PENDENCIA =='Nenhum'){
						checkbox.prop('checked', false);
					} else {
						checkbox.prop('indeterminate', true);
					} 
					/*
					if (item.EXECUTAR === 'True') {
						checkbox.prop('checked', true);
					} else {
						//checkbox.prop("disabled", true)
					}
					*/
					divF.append(checkbox);
					
					
					col.append(divF);
					div.append(col);
					td.append(div);
					row.append(td);
					
					row.on('dblclick', function () {
						const checkbox = $(this).find('input[type="checkbox"]');
						if (checkbox.prop('indeterminate')){
							checkbox.prop('indeterminate', false);
							checkbox.prop('checked', false);
						} else if (checkbox) {
							checkbox.prop('checked', !checkbox.prop('checked'));
						}
						repetirCliente(item.ID_CLIENTE, null);
					});
					
					tableBody.append(row);
				});
				
				initializePagination(data, nPag, 'myTable', 'pagination' );
				
				var processCheckboxAll = document.querySelector('.ProcessCheckboxAll');
				var processCheckboxes = document.querySelectorAll('.ProcessCheckbox');
				var observacaoCheckboxes = document.querySelectorAll('.observacao');
				var executarCheckboxes = document.querySelectorAll('.executar');
				

				processCheckboxAll.addEventListener('change', function() {
					
					if (processCheckboxAll.checked) {
						repetirAutomacao(null);
					  // Marca todos os checkboxes "ProcessCheckbox"
						processCheckboxes.forEach(function(processCheckbox, index) {
							if (!processCheckbox.disabled) {
								processCheckbox.indeterminate = false;
								processCheckbox.checked = true;
								observacaoCheckboxes[index].style.display = 'block';
								if (observacaoCheckboxes[index].textContent  === '' || observacaoCheckboxes[index].textContent  === null || observacaoCheckboxes[index].textContent  === undefined){
									//repetirCliente(executarCheckboxes[index].value, null);
								}
								
							}
						});
					} else {
						// Desmarca todos os checkboxes "ProcessCheckbox"
						processCheckboxes.forEach(function(processCheckbox, index) {
							processCheckbox.indeterminate = false;
							processCheckbox.checked = false;
							observacaoCheckboxes[index].style.display = 'none';
							processCheckbox.name = executarCheckboxes[index].value+'Nenhum';
						});
					}
				});
				
				hideLoading(); // desativa animação
				
			} else if (elementId === 'listaImportacao') {
				var tabela = document.getElementById('myTableImportacao');
				while (tabela.rows.length > 0) {
					tabela.deleteRow(0);
				}
				var jsonData = value;
				var data = JSON.parse(jsonData);
				var tableBody = $("#myTableImportacao");
				var nItem = 0;
				var altura = window.innerHeight;
				var nPag = 15;
				data.forEach(function(item) {
					var row = $('<tr>');
					nItem++;
					if(nItem > nPag){
						row.css('display', 'none');
					}
					var td = $('<td>').prop('class', 'col-1').prop('id','IMP_CODIGO').prop('value', item.CODIGO).text(item.CODIGO);
					row.append(td);
					
					td = $('<td>').prop('class', 'col-2 me-2');
					var div = $('<div>').prop('class', 'd-flex justify-content-center').text(item.CNPJ);
					td.append(div);
					row.append(td);
					
					td = $('<td>').prop('class', 'col-8').text(item.EMPRESA);
					row.append(td);
					
					td = $('<td>').prop('class', 'col-1');
					var btn = $('<button>').attr('type', 'button').prop('class', 'btn btn-warning custom-btn-extra-small').attr('onclick', 'adicionarCliente('+item.CODIGO+')').prop('name', item.CODIGO).prop("value",item.CODIGO).text('Importar');
					div = $('<div>').prop('class', 'd-flex justify-content-end');
					div.append(btn);
					td.append(div);
					row.append(td);
					
					tableBody.append(row);
				});
				initializePagination(data, nPag, 'myTableImportacao', 'paginationImportacao');
						//initializePagination(data, nPag);
			} else {
				var el = document.getElementById(elementId);
				if (el == null) {
					var el = document.getElementById(value);
				} 
				if ((el.tagName === 'INPUT' && el.type === 'text') || el.type === 'email') {
					el.value = value;
				} else if (el.tagName === 'INPUT' && el.type === 'file') {
					el.value = value;
				} else if (el.tagName === 'SELECT') {
					el.value = value;
				}  else {
					el.innerHTML = value;
				}
			}
		},
		sendMessage: function (id, value) { },
	};
 </script>

</head>
<body>
	
	<div class="overlay" id="overlay">
		<!--div class="loader"></div-->
		<div class="lottie-animation" id="lottie-animation"></div>
		<div class="loading-text">Carregando...</div>
	</div>
	
	<header>
	  <div class="logo d-flex justify-content-center align-items-center">
		 <img src="https://trunan.com.br/_trunan/img/rpa.png" alt="truNaN" width="150" height="auto">
	  </div>

	  <div class="search d-flex align-items-center " >
		<div class="col-4 d-flex justify-content-start align-items-center">
			<input type="text" class="form-control form-control-extra-sm m-2" id="Periodo" name="Periodo" data-inputmask="'mask': '99/9999'" placeholder="" value="" style="width: 75px;">
			<select class="form-select select-control-extra-sm me-2" id="Perfil" style="width: 250px;"></select>
			<!--select class="form-select select-control-extra-sm me-2" id="RepetirAutomacao" style="width: 125px;">
				<option value="False">Rotinas Pendentes</option>
				<option value="True">Repetir as Rotinas</option>
			</select-->
		</div>
		<div class="col-4 d-flex justify-content-center">
			<input type="text" class="form-control form-control-extra-sm" id="myInput" placeholder="Pesquisar..." style="width: 250px;">
		</div>
		<div class="col-4 d-flex justify-content-end">
			<div class="dropdown">
			  <button class="btn btn-warning custom-btn-extra-small" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="width: 100px; height: 25px">
				<i class="bi bi-gear"></i> Configurações
			  </button>
			  <ul class="dropdown-menu dropdown-menu-dark  small-text">
				<li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#parametrosModal">Parâmetros</a></li>
				<li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#dominioModal">Sistema Domínio</a></li>
				<li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#perfilModal">Perfil Automação</a></li>
				<li><hr class="dropdown-divider"></li>
				<li><a class="dropdown-item" onclick="fecharAutomacao()">Fechar</a></li>
			  </ul>
			</div>
		</div>
	  </div>
	</header>
	<main>
      <!-- Conteúdo da barra lateral direita -->
		<aside id="menu"></aside>
	
		<!-- Conteúdo principal com barra de rolagem -->
		<div class="scrollable-content">
			<div class="table-responsive-sm ">
				<table class="table table-sm table-dark caption-top table-striped table-hover" >
					<thead class="table-dark">
						<tr class="align-items-center small-text" id="myTableHead">
							<th class="col-6 fw-normal">
								<div class="d-flex justify-content-start align-items-center">
									<button id="addPerfil" type="button" class="btn btn-primary custom-btn-extra-small me-2" data-bs-toggle="modal" data-bs-target="#clienteModal" onclick="limparModalCliente()"><i class="bi bi-person-plus-fill"></i></button>
									<div class="col-1" >Cod</div>
									<div class="col-2 d-flex justify-content-center  me-2" ><div class="d-flex justify-content-center">CNPJ/CPF</div></div>
									<div class="col-9" >Empresa</div>
								</div>
							</th>
							<th class="col-6 fw-normal">
								<div class="d-flex justify-content-start align-items-center">
									<div class="col-11" >Observação</div>
									<div class="col-1" >
										<div class="d-flex justify-content-end align-items-center">
											<input type="checkbox" class="ProcessCheckboxAll form-check-input" value="" id="FiltroCheckbox">
										</div>
									</div>
									
								</div>
							</th>
						</tr>
					</thead>
					<tbody id="myTable" class="small-text">
						<!--tr class="align-items-center">
							<td class="col-6 fw-normal">
								<div class="d-flex justify-content-start align-items-center">
									<button id="addPerfil" type="button" class="btn btn-primary custom-btn-extra-small me-2" data-bs-toggle="modal" data-bs-target="#clienteModal" onclick="limparModalCliente()"><i class="bi bi-person-plus-fill"></i></button>
									<div class="col-1" >9999</div>
									<div class="col-2 d-flex justify-content-center" >00.795.877/0001-16</div>
									<div class="col-9" >Evoluze softwares de gestao ltda 123</div>
								</div>
							</td>
							<td class="col-6 fw-normal">
								<div class="d-flex justify-content-start align-items-center">
									<div class="col-11" >XML-PDF Saida XML-PDF Entrada Protocolar Saida Protocolar Entrada SimplesNacional | Login Cliente</div>
									<div class="col-1" >
										<div class="d-flex justify-content-end align-items-center">
											<input type="checkbox" class="ProcessCheckbox form-check-input" id='EXECUTAR'>
										</div>
									</div>
								</div>
							</td>
						</tr-->
					</tbody>
				</table>
			</div>
		</div>
    </main>
	
	<footer id="footer"></footer>
  
	<div id="modal_repetir_automacao"></div>
	<div id="modal_dominio"></div>
	<div id="modal_cliente"></div>
	<div id="modal_parametros"></div>
	<div id="modal_perfil"></div>
	
<script>
	function limparModalCliente() {
		//Chave = ID do campo, Valor = Bloquear ou não o campo se for input
		var jsonData = {
			"LOGIN": false,
			"PASSWORD": false,
			"CODIGO_LOGIN": true,
			"CADASTRO_ECONOMICO": true
		};
		limparFormCliente(JSON.stringify(jsonData));
	}
	
	var selectPerfil = document.getElementById('Perfil');
	function perfilChanged() {
		var selectedValue = selectPerfil.value;
		changedPerfil(selectedValue);
	}
	selectPerfil.addEventListener('change', perfilChanged);
	document.getElementById('Periodo').addEventListener('blur', perfilChanged);
	
	
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.8/lottie.min.js"></script>

<script src="js/uipath_input.js"></script>
<script src="js/uipath_output.js"></script>
<script src="js/contents.js"></script>
<script src="animacao.js"></script>
<script src="js/paginacao.js"></script>	
<script src="js/validacoes.js"></script>
<script src="js/change.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://trunan.com.br/_trunan/www/js/bootpag.js"></script>
  
</body>
</html>
